针对您部署的Web服务出现403 Forbidden错误且需隐藏敏感信息的问题，结合Nginx 1.18.0特性及Ubuntu环境，提供以下系统性解决方案：

### **一、诊断403错误根源**

1. 权限问题排查
   - **检查Nginx运行用户**：执行`ps aux | grep "nginx: worker process" | awk '{print $1}'`确认进程用户（如`nginx`/`www-data`），确保与Web目录所有者一致。若不一致，修改`nginx.conf`中`user`指令为目录所有者用户。
   - **目录/文件权限**：使用`ls -l /path/to/webroot`检查目录权限。静态文件需`644`，目录需`755`。执行`chmod -R 755 /path/to/webroot`和`chown -R nginx:nginx /path/to/webroot`调整权限。
   - **SELinux干预**：执行`getenforce`检查状态。若为`Enforcing`，临时禁用（`setenforce 0`）或永久禁用（修改`/etc/selinux/config`中`SELINUX=disabled`后重启）。
2. 配置与资源验证
   - **Index文件缺失**：在`server`块中确认`index`指令指向的文件（如`index.html`）存在于Web根目录。
   - **配置语法校验**：执行`nginx -t`验证配置文件无语法错误，确保`root`指令路径正确且目录存在。

### **二、隐藏敏感信息的关键配置**

1. 自定义错误页面

   - 在

     ```
     server
     ```

     或

     ```
     http
     ```

     块中添加：

     ```nginx
     error_page 403 /custom_403.html;
     location = /custom_403.html {
         internal;  # 禁止直接访问
         root /etc/nginx/error_pages;  # 错误页面存放目录
     }
     ```

   - 创建`/etc/nginx/error_pages/custom_403.html`，设计无服务器信息的友好提示（如“访问受限，请联系管理员”）。

   - 启用动态错误拦截：在`location ~ \.php$`块中添加`fastcgi_intercept_errors on;`。

2. 隐藏Nginx版本与标识

   - 修改

     ```
     nginx.conf
     ```

     的

     ```
     http
     ```

     块：

     ```nginx
     server_tokens off;  # 禁用响应头中的版本号
     more_set_headers "Server: WebServer";  # 自定义Server头（需安装`headers-more`模块）
     ```

   - 若需深度隐藏，编译时修改源码：编辑`nginx-1.18.0/src/core/nginx.h`，修改`NGINX_VERSION`和`NGINX_VER`为自定义值后重新编译。

### **三、高级防护措施**

- **目录浏览禁止**：在`location /`中添加`autoindex off;`，防止目录列表暴露文件结构。

- 安全响应头

  ：添加以下配置增强安全性：

  ```nginx
  add_header X-Content-Type-Options "nosniff";
  add_header X-Frame-Options "SAMEORIGIN";
  add_header Content-Security-Policy "default-src 'self'";
  ```

- **日志脱敏**：修改`access_log`格式，移除`$server_name`等敏感字段，或配置日志管道过滤敏感信息。

### **四、验证与调试**

1. **测试配置**：执行`nginx -t && systemctl reload nginx`应用新配置。
2. **错误模拟**：使用`curl -I http://your-domain/nonexistent`触发403，检查响应头是否隐藏版本号，并验证自定义错误页面是否生效。
3. **日志监控**：通过`tail -f /var/log/nginx/error.log`实时观察错误日志，确认无权限类错误记录。

通过上述步骤，您既能解决403 Forbidden问题，又能确保客户端仅看到预设的友好错误提示，而无法获取服务器版本、路径等敏感信息。若问题仍存，建议结合`strace`跟踪Nginx进程或检查防火墙规则，进一步定位深层原因。