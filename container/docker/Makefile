all:help

## build@ç¼–è¯‘
.PHONY:build
build:
	@echo "=> ğŸš€ ç¼–è¯‘Goåº”ç”¨"
	@mkdir -p /tmp/deploy
	@GOOS=linux GOARCH=amd64 go build -o /tmp/deploy/hello-server
	@tar -zcvf deploy.tar.gz -C /tmp/deploy ./
	@echo "ğŸš€ æ„å»ºdockeré•œåƒ"
	@docker build -f Dockerfile -t hello:1.0 .
	@echo "\033[31m ğŸš€  ç¼–è¯‘å®Œæ¯•\033[0m"


## clean@æ¸…ç†ç¼–è¯‘ã€æ—¥å¿—å’Œç¼“å­˜ç­‰
.PHONY:clean
clean:
	@docker images|grep none|awk '{print $3}'|xargs docker rmi -f
	@rm -rf ./logs;
	@rm -rf ./log;
	@rm -rf ./cache;
	@rm -rf ./pid;
	@rm -rf ./release;
	@rm -rf ./debug;
	@rm -rf ./vendor/*;
	@rm -rf /tmp/deploy/*
	@echo "\033[31m âœ…  æ¸…ç†å®Œæ¯•\033[0m";


## commit <msg>@Gitæäº¤ï¼Œå¦‚:make push [msg=<message>]
.PHONY:commit
message:=$(if $(msg),$(msg),"rebuilded at $$(date '+%Y/%m/%d %H:%M:%S')")
commit:
	@echo "\033[0;34mPush to remote...\033[0m"
	@git add .
	@git commit -m $(message)
	@echo "\033[0;31m ğŸ’¿ Commitå®Œæ¯•\033[0m"


## push <msg>@Gitæäº¤å¹¶æ¨é€ï¼Œå¦‚:make push [msg=<message>]
.PHONY:push
push:commit
	@git push #origin master
	@echo "\033[0;31m â¬†ï¸ Pushå®Œæ¯•\033[0m"


## exec@æ‰§è¡Œdocker exec
.PHONY:exec
exec:
	@docker exec -ti hello  #origin master


## run@dockerè¿è¡Œhello
.PHONY:run
run:
	@docker rm -f hello
	@docker run -d --name hello -p 8080:8080 hello:1.0
	@docker ps


## my@æˆ‘çš„ä¸€é”®å¼æ“ä½œ
.PHONY:my
my: build run


## help@æŸ¥çœ‹makeå¸®åŠ©
.PHONY:help
help:Makefile
	@echo "Usage: \n  make [command]"
	@echo
	@echo "Available Commands:"
	@sed -n "s/^##//p" $< | column -t -s '@' |grep --color=auto "^[[:space:]][a-z]\+[[:space:]]"
	@echo "For more to https://github.com/hollson\n"